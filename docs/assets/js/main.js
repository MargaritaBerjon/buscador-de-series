"use strict";const inputSearch=document.querySelector(".js-input-search"),buttonSearch=document.querySelector(".js-button-search"),favoritesList=document.querySelector(".js-favorites"),resultsContainer=document.querySelector(".js-results-search");let seriesResult=[],favoriteArr=[];function getFavoritesFromLocalStorage(){if(JSON.parse(localStorage.getItem("favorites"))){favoriteArr=JSON.parse(localStorage.getItem("favorites"));for(const e of favoriteArr)paintFavoriteSerie(e)}}function callSeriesResult(e){e.preventDefault();const t=inputSearch.value.toLowerCase();fetch(`http://api.tvmaze.com/search/shows?q=${t}`).then(e=>e.json()).then(e=>{seriesResult=e,paintSeries()})}function paintSeries(){resultsContainer.innerHTML="";for(const e of seriesResult){const t=paintSerie(e,resultsContainer);t.addEventListener("click",addFavorite);for(const r of favoriteArr)e.show.id===r.show.id&&t.classList.add("card-result-favorite")}}function paintSerie(e,t){const r=document.createElement("li"),i=document.createElement("img"),o=document.createElement("p");return o.innerHTML=e.show.name,null!==e.show.image?i.src=e.show.image.medium:i.src="https://via.placeholder.com/210x295/ffffff/666666/?",r.id=e.show.id,r.appendChild(i),r.appendChild(o),r.classList.add("card","js-card"),t.appendChild(r),t.classList.add("series-result"),r}function addFavorite(e){const t=e.currentTarget.id,r=findSerie(t,seriesResult);findSerie(t,favoriteArr)?alert("SERIE YA ESTA EN FAVORITOS"):(e.currentTarget.classList.remove("card"),e.currentTarget.classList.add("card-result-favorite"),paintFavoriteSerie(r),saveFavoriteSerie(r),buttonRemoveVisibility())}function removeFavorite(e){const t=findSerie(e.currentTarget.parentElement.id,favoriteArr);favoriteArr.splice(favoriteArr.indexOf(t),1),localStorage.setItem("favorites",JSON.stringify(favoriteArr)),favoritesList.removeChild(e.currentTarget.parentElement),paintSeries(),buttonRemoveVisibility()}function saveFavoriteSerie(e){favoriteArr.push(e),localStorage.setItem("favorites",JSON.stringify(favoriteArr))}function paintFavoriteSerie(e){const t=paintSerie(e,favoritesList);favoritesList.classList.remove("series-result"),t.classList.remove("card"),t.classList.add("favorite-card"),t.querySelector("img").classList.add("img-favorite");const r=document.createElement("button");r.innerHTML="x",t.appendChild(r),r.classList.add("icon-delete"),r.addEventListener("click",removeFavorite)}function findSerie(e,t){return e=parseInt(e),t.find(t=>t.show.id===e)}function buttonRemoveVisibility(){const e=document.querySelector(".js-favorite-container"),t=document.querySelector(".delete-all-favorites");if(favoriteArr.length){if(!t){const t=document.createElement("button");t.innerHTML="Borrar favoritos",t.classList.add("delete-all-favorites"),e.appendChild(t),document.querySelector(".delete-all-favorites").addEventListener("click",removeAllFavorites)}}else t&&e.removeChild(t.parentElement.lastChild)}function removeAllFavorites(){favoriteArr=[],favoritesList.innerHTML="",localStorage.removeItem("favorites"),buttonRemoveVisibility()}getFavoritesFromLocalStorage(),buttonRemoveVisibility(),buttonSearch.addEventListener("click",callSeriesResult);